{"version":3,"sources":["Box/game.js","Box/index.js","App.js","reportWebVitals.js","index.js"],"names":["randomString","len","$chars","maxPos","length","pwd","i","charAt","Math","floor","random","sleep","t","Promise","resolve","reject","setTimeout","getRandomAnmal","list","Gamer","x","y","init","onDataChange","onScoreChange","onTimeChange","Howler","volume","sound","map","Howl","src","onplayerror","err","this","once","play","onend","start","timeLoop","time","alert","score","getData","data","update","click","o","a","selectIdx","findIndex","select","objIdx","setIn","a2b","maxX","maxY","combo","List","m","n","j","animal","push","id","initData","checkStatus","transXYMap","transMaxXYMap","checkLine","row","type","current","p","q","result","getValue","value","idx","loop","next","find","getItem","removeList","s","flatten","unionBy","status","temp","sumMap","undefined","sum","b","ax","getIn","ay","bx","by","abs","getRemoveList","remove","setRemoveStatus","setRemovePosition","getDownList","gamer","useState","setList","setScore","setTime","width","setWidth","useEffect","document","querySelector","offsetWidth","className","style","paddingTop","onClick","cls","removed","removing","height","transform","animate__tada","backgroundImage","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.9453833c.chunk.js","sourcesContent":["import flatten from \"lodash/flatten\";\r\nimport unionBy from \"lodash/unionBy\";\r\nimport { List } from \"immutable\";\r\nimport { Howl, Howler } from \"howler\";\r\n\r\nexport const randomString = (len = 32) => {\r\n  const $chars = \"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678\";\r\n  /** **默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1*** */\r\n  const maxPos = $chars.length;\r\n  let pwd = \"\";\r\n  for (let i = 0; i < len; i += 1) {\r\n    pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\r\n  }\r\n  return pwd;\r\n};\r\n\r\nconst sleep = (t) => new Promise((resolve, reject) => setTimeout(resolve, t));\r\n\r\nfunction getRandomAnmal() {\r\n  const list = [\r\n    // \"alligator\",\r\n    \"chicken\",\r\n    \"frog\",\r\n    // \"mouse\",\r\n    \"sea-lion\",\r\n    \"bear\",\r\n    \"dog\",\r\n    // \"hippo\",\r\n    // \"owl\",\r\n    // \"sheep\",\r\n    // \"bull\",\r\n    // \"duck\",\r\n    // \"lion\",\r\n    // \"panda\",\r\n    // \"snake\",\r\n    // \"cat\",\r\n    // \"elephant\",\r\n    // \"monkey\",\r\n    // \"pig\",\r\n    // \"tiger\",\r\n  ];\r\n\r\n  const i = Math.floor(Math.random() * list.length);\r\n  return list[i];\r\n}\r\n\r\nfunction initData(m, n) {\r\n  const list = [];\r\n  for (let i = 0; i < m; i++) {\r\n    for (let j = 0; j < n; j++) {\r\n      const animal = getRandomAnmal();\r\n      list.push({\r\n        id: randomString(),\r\n        x: i,\r\n        y: j,\r\n        animal,\r\n        select: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  return list;\r\n}\r\n\r\nclass Gamer {\r\n  constructor(x, y) {\r\n    this.maxX = x;\r\n    this.maxY = y;\r\n  }\r\n\r\n  start() {\r\n    this.score = 0;\r\n    this.combo = 0;\r\n    this.time = 30000;\r\n    this.data = List(initData(this.maxX, this.maxY));\r\n\r\n    this.onDataChange(this.data);\r\n    this.onScoreChange(this.score);\r\n    this.onTimeChange(this.time);\r\n    this.checkStatus();\r\n    this.timeLoop();\r\n  }\r\n\r\n  init = ({ onDataChange, onScoreChange, onTimeChange }) => {\r\n    Howler.volume(0.5);\r\n\r\n    this.sound = {};\r\n\r\n    [\"d1\", \"d2\", \"keyboard\"].map((i) => {\r\n      this.sound[i] = new Howl({\r\n        src: [\"./audios/\" + i + \".mp3\"],\r\n        onplayerror: function (err) {\r\n          this.sound.once(\"unlock\", function () {\r\n            this.sound.play();\r\n          });\r\n        },\r\n        volume: 0.5,\r\n        onend: function () {},\r\n      });\r\n    });\r\n\r\n    this.onDataChange = onDataChange;\r\n    this.onScoreChange = onScoreChange;\r\n    this.onTimeChange = onTimeChange;\r\n\r\n    this.start();\r\n  };\r\n\r\n  timeLoop = () => {\r\n    if (this.time > 0) {\r\n      this.time = this.time - 1000;\r\n      this.onTimeChange(this.time);\r\n      setTimeout(() => {\r\n        this.timeLoop();\r\n      }, 1000);\r\n    } else {\r\n      alert(\"game over, socre:\" + this.score);\r\n      this.start();\r\n    }\r\n  };\r\n\r\n  getData = () => {\r\n    return this.data;\r\n  };\r\n\r\n  update = () => {\r\n    this.onDataChange(this.data);\r\n  };\r\n\r\n  getRemoveList(data) {\r\n    const transXYMap = {\r\n      x: \"y\",\r\n      y: \"x\",\r\n    };\r\n\r\n    const transMaxXYMap = {\r\n      x: this.maxX,\r\n      y: this.maxY,\r\n    };\r\n\r\n    function checkLine(list, row, type) {\r\n      let p = 0;\r\n      let q = 0;\r\n      let result = [];\r\n\r\n      function getItem(data) {\r\n        const item = list.find(\r\n          (i) => i[type] === data && i[transXYMap[type]] === row\r\n        );\r\n\r\n        return item;\r\n      }\r\n\r\n      function getValue(value) {\r\n        let x;\r\n        let y;\r\n        let idx;\r\n        if (type === \"x\") {\r\n          x = value;\r\n          y = row;\r\n        }\r\n        if (type === \"y\") {\r\n          x = row;\r\n          y = value;\r\n        }\r\n        idx = list.findIndex((i) => i.x === x && i.y === y);\r\n        return { x, y, idx };\r\n      }\r\n\r\n      let current;\r\n\r\n      function loop() {\r\n        let next = getItem(q);\r\n\r\n        if (!next) {\r\n          current = null;\r\n          if (q < transMaxXYMap[type] - 1) {\r\n            q += 1;\r\n            loop();\r\n            return;\r\n          }\r\n        }\r\n\r\n        if (!current) {\r\n          current = next;\r\n        }\r\n\r\n        if (current.animal !== next.animal) {\r\n          if (q - 1 - p > 1) {\r\n            for (let x = p; x <= q - 1; x++) {\r\n              result.push(getValue(x));\r\n            }\r\n          }\r\n          p = q;\r\n        }\r\n\r\n        if (q === transMaxXYMap[type] - 1) {\r\n          if (q - p > 1) {\r\n            for (let x = p; x <= q; x++) {\r\n              result.push(getValue(x));\r\n            }\r\n          }\r\n          return;\r\n        }\r\n\r\n        if (q < transMaxXYMap[type] - 1) {\r\n          q += 1;\r\n          current = next;\r\n          loop();\r\n          return;\r\n        }\r\n      }\r\n\r\n      loop();\r\n\r\n      return result;\r\n    }\r\n\r\n    let removeList = [];\r\n    for (let i = 0; i < this.maxY; i++) {\r\n      removeList.push(checkLine(data, i, \"x\"));\r\n    }\r\n    for (let i = 0; i < this.maxX; i++) {\r\n      removeList.push(checkLine(data, i, \"y\"));\r\n    }\r\n    const s = flatten(removeList);\r\n    const t = unionBy(s, (i) => i.idx);\r\n    removeList = t;\r\n    return removeList;\r\n  }\r\n\r\n  setRemoveStatus(removeList, status) {\r\n    let temp = this.data;\r\n    removeList.map(({ idx }) => {\r\n      temp = temp.setIn([idx, \"status\"], status);\r\n    });\r\n    return temp;\r\n  }\r\n\r\n  setRemovePosition(removeList) {\r\n    let temp = this.data;\r\n    let sumMap = {};\r\n    removeList.map(({ idx, x, y }) => {\r\n      if (sumMap[x] === undefined) {\r\n        sumMap[x] = -1;\r\n      } else {\r\n        sumMap[x] = sumMap[x] - 1;\r\n      }\r\n      temp = temp\r\n        .setIn([idx, \"y\"], sumMap[x])\r\n        // .setIn([idx, \"remove\"], false)\r\n        .setIn([idx, \"animal\"], getRandomAnmal());\r\n    });\r\n    return temp;\r\n  }\r\n\r\n  getDownList() {\r\n    let temp = this.data;\r\n    for (let x = 0; x < this.maxX; x++) {\r\n      let sum = 0;\r\n      for (let y = -this.maxY; y < this.maxY; y++) {\r\n        const idx = this.data.findIndex((i) => i.x === x && i.y === y);\r\n        if (idx !== -1) {\r\n          temp = temp.setIn([idx, \"y\"], sum);\r\n          sum++;\r\n        }\r\n      }\r\n    }\r\n    this.data = temp;\r\n  }\r\n\r\n  a2b(a, b) {\r\n    const ax = this.data.getIn([a, \"x\"]);\r\n    const ay = this.data.getIn([a, \"y\"]);\r\n    const bx = this.data.getIn([b, \"x\"]);\r\n    const by = this.data.getIn([b, \"y\"]);\r\n\r\n    // 如果不是水平方向平移一位\r\n    if (Math.abs(ax - bx) + Math.abs(ay - by) != 1) {\r\n      return;\r\n    }\r\n\r\n    const temp = this.data\r\n      .setIn([a, \"x\"], bx)\r\n      .setIn([a, \"y\"], by)\r\n      .setIn([b, \"x\"], ax)\r\n      .setIn([b, \"y\"], ay);\r\n\r\n    const removeList = this.getRemoveList(temp);\r\n    if (removeList.length > 0) {\r\n      this.data = temp;\r\n      this.remove(removeList);\r\n    }\r\n  }\r\n\r\n  click = async (o) => {\r\n    this.sound[\"keyboard\"].play();\r\n\r\n    const selectIdx = this.data.findIndex((i) => i.select);\r\n    const objIdx = this.data.findIndex((i) => i.x === o.x && i.y === o.y);\r\n    if (selectIdx != -1) {\r\n      if (selectIdx === objIdx) {\r\n        this.data = this.data.setIn([objIdx, \"select\"], false);\r\n      } else {\r\n        this.a2b(selectIdx, objIdx);\r\n        this.data = this.data.setIn([selectIdx, \"select\"], false);\r\n      }\r\n      // setList(a2b(this.data, selectIdx, objIdx).setIn([selectIdx, \"select\"], false));\r\n    } else {\r\n      this.data = this.data.setIn([objIdx, \"select\"], true);\r\n    }\r\n    this.update();\r\n    // this.checkStatus();\r\n  };\r\n\r\n  async remove(removeList) {\r\n    this.sound[\"d1\"].play();\r\n\r\n    this.score = this.score + removeList.length * this.combo * 100;\r\n    this.onScoreChange(this.score);\r\n    this.time = this.time + 1000;\r\n    if (this.time > 30000) {\r\n      this.time = 30000;\r\n    }\r\n    this.onTimeChange(this.time);\r\n\r\n    this.data = this.setRemoveStatus(removeList, \"removing\");\r\n    this.update();\r\n\r\n    await sleep(1000);\r\n    this.data = this.setRemoveStatus(removeList, \"removed\");\r\n    this.update();\r\n\r\n    await sleep(30);\r\n    this.data = this.setRemovePosition(removeList);\r\n    this.update();\r\n\r\n    await sleep(30);\r\n    this.data = this.setRemoveStatus(removeList, \"ok\");\r\n    this.update();\r\n\r\n    await sleep(30);\r\n    this.getDownList();\r\n    this.update();\r\n\r\n    await sleep(300);\r\n    this.checkStatus();\r\n  }\r\n\r\n  async checkStatus() {\r\n    const removeList = this.getRemoveList(this.data);\r\n    if (removeList.length === 0) return; // 检查是否有需要更新的方块\r\n\r\n    // 重新计算移除组\r\n    if (removeList.length === 0) {\r\n      // 重置连击数\r\n      this.combo = 0;\r\n      return;\r\n    }\r\n\r\n    // 累计连击数\r\n    this.combo = this.combo + 1;\r\n    await this.remove(removeList);\r\n  }\r\n}\r\n\r\nexport default Gamer;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport cls from \"classnames\";\r\nimport flatten from \"lodash/flatten\";\r\nimport unionBy from \"lodash/unionBy\";\r\nimport { List } from \"immutable\";\r\nimport Gamer from \"./game\";\r\nimport \"animate.css\";\r\nimport \"./index.css\";\r\n\r\nconst m = 9;\r\nconst n = 9;\r\n\r\nconst gamer = new Gamer(m, n);\r\n\r\nexport default() => {\r\n    const [list, setList] = useState(null)\r\n    const [score, setScore] = useState(0)\r\n    const [time, setTime] = useState(0)\r\n    const [width, setWidth] = useState(0)\r\n\r\n    useEffect(() => {\r\n        setWidth(document.querySelector('.root').offsetWidth / m)\r\n    }, [])\r\n\r\n    function test(o) {\r\n        gamer.click(o)\r\n    }\r\n\r\n    function start() {\r\n      gamer.init({\r\n        onDataChange: setList,\r\n        onScoreChange: setScore,\r\n        onTimeChange: setTime,\r\n      });\r\n    }\r\n\r\n    return (\r\n        <div className=\"root\">\r\n          {list ? (\r\n            <>\r\n              <div className=\"header\">\r\n                <h1>Score: {score}</h1>\r\n                <h1>Time: {time / 1000}</h1>\r\n              </div>\r\n    \r\n              <div className=\"list\" style={{ paddingTop: (n / m) * 100 + \"%\" }}>\r\n                {list.map((i) => {\r\n                  return (\r\n                    <div\r\n                      onClick={() => {\r\n                        test(i);\r\n                      }}\r\n                      className={cls([\r\n                        \"item\",\r\n                        // \"animate__animated\",\r\n                        {\r\n                          select: i.select,\r\n                          removed: i.status === \"removed\",\r\n                          removing: i.status === \"removing\",\r\n                          // animate__tada: i.remove,\r\n                        },\r\n                      ])}\r\n                      key={i.id}\r\n                      style={{\r\n                        width: width,\r\n                        height: width,\r\n                        transform:\r\n                          \"translate3d(\" +\r\n                          i.x * width +\r\n                          \"px,\" +\r\n                          i.y * width +\r\n                          \"px,0)\",\r\n                        // left: i.x * width + \"px\",\r\n                        // top: i.y * width + \"px\",\r\n                        // backgroundImage: \"url(./images/\" + i.animal + \".svg)\",\r\n                      }}\r\n                    >\r\n                      <div\r\n                        className={cls([\r\n                          \"icon\",\r\n                          \"animate__animated\",\r\n                          {\r\n                            animate__tada: i.status === \"removing\",\r\n                          },\r\n                        ])}\r\n                        key={i.id}\r\n                        style={{\r\n                          width: width,\r\n                          height: width,\r\n                          backgroundImage: \"url(./images/\" + i.animal + \".svg)\",\r\n                        }}\r\n                      >\r\n                        {/* {i.status + \":\" + i.x + \",\" + i.y} */}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div>\r\n              <div>冲呀</div>\r\n              <div className=\"start\" onClick={start}>\r\n                START\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      );\r\n}","import './App.css';\nimport Box from './Box'\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Box></Box>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}